# Utils API Documentation

Daily Report Botã®å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€‚

## æ¦‚è¦

`src/utils/` ã«ã¯ã€æ™‚é–“è¨ˆç®—ã€ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†ã€Notionãƒ–ãƒ­ãƒƒã‚¯ç”Ÿæˆã®æ±ç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

## ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆ

```
src/utils/
â”œâ”€â”€ __init__.py         # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®šç¾©
â”œâ”€â”€ time_utils.py       # æ™‚é–“è¨ˆç®—ãƒ˜ãƒ«ãƒ‘ãƒ¼
â”œâ”€â”€ text_utils.py       # ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†ãƒ˜ãƒ«ãƒ‘ãƒ¼
â””â”€â”€ block_builder.py    # Notionãƒ–ãƒ­ãƒƒã‚¯ç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼
```

---

## block_builder - Notionãƒ–ãƒ­ãƒƒã‚¯ç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼

æ—¥å ±ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰Notion APIã®ãƒ–ãƒ­ãƒƒã‚¯æ§‹é€ ã‚’ç”Ÿæˆã€‚

### åŸºæœ¬ãƒ–ãƒ­ãƒƒã‚¯ç”Ÿæˆé–¢æ•°

#### `heading_2(text: str) -> dict[str, Any]`

è¦‹å‡ºã—2ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç”Ÿæˆã€‚

**å¼•æ•°:**
- `text` (str): è¦‹å‡ºã—ãƒ†ã‚­ã‚¹ãƒˆ

**æˆ»ã‚Šå€¤:**
- `dict`: Notion APIã®heading_2ãƒ–ãƒ­ãƒƒã‚¯

**ä½¿ç”¨ä¾‹:**
```python
from src.utils.block_builder import heading_2

block = heading_2("ğŸ“Š åŸºæœ¬æƒ…å ±")
# -> {"type": "heading_2", "heading_2": {"rich_text": [...]}}
```

---

#### `paragraph(text: str) -> dict[str, Any]`

æ®µè½ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç”Ÿæˆã€‚æ”¹è¡Œã‚’å«ã‚€ãƒ†ã‚­ã‚¹ãƒˆã«ã‚‚å¯¾å¿œã€‚

**å¼•æ•°:**
- `text` (str): æ®µè½ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæ”¹è¡Œå«ã‚€å¯ï¼‰

**æˆ»ã‚Šå€¤:**
- `dict`: Notion APIã®paragraphãƒ–ãƒ­ãƒƒã‚¯

**ä½¿ç”¨ä¾‹:**
```python
from src.utils.block_builder import paragraph

block = paragraph("è¨˜éŒ²æœŸé–“: 09:00 ã€œ 18:00\nã‚­ãƒ£ãƒ—ãƒãƒ£æ•°: 240å›")
# -> {"type": "paragraph", "paragraph": {"rich_text": [...]}}
```

---

#### `numbered_list_item(text: str) -> dict[str, Any]`

ç•ªå·ä»˜ããƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã‚’ç”Ÿæˆã€‚

**å¼•æ•°:**
- `text` (str): ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ãƒ†ã‚­ã‚¹ãƒˆ

**æˆ»ã‚Šå€¤:**
- `dict`: Notion APIã®numbered_list_itemãƒ–ãƒ­ãƒƒã‚¯

**ä½¿ç”¨ä¾‹:**
```python
from src.utils.block_builder import numbered_list_item

block = numbered_list_item("ãƒ‡ãƒ¼ã‚¿é›†è¨ˆå‡¦ç†ã‚’å®Ÿè£…")
# -> {"type": "numbered_list_item", ...}
```

---

#### `bulleted_list_item(text: str) -> dict[str, Any]`

ç®‡æ¡æ›¸ããƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã‚’ç”Ÿæˆã€‚

**å¼•æ•°:**
- `text` (str): ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ãƒ†ã‚­ã‚¹ãƒˆ

**æˆ»ã‚Šå€¤:**
- `dict`: Notion APIã®bulleted_list_itemãƒ–ãƒ­ãƒƒã‚¯

**ä½¿ç”¨ä¾‹:**
```python
from src.utils.block_builder import bulleted_list_item

block = bulleted_list_item("[æŠ€è¡“] Pydanticã®å‹æ¤œè¨¼ãŒä¾¿åˆ©")
# -> {"type": "bulleted_list_item", ...}
```

---

#### `divider() -> dict[str, Any]`

åŒºåˆ‡ã‚Šç·šãƒ–ãƒ­ãƒƒã‚¯ã‚’ç”Ÿæˆã€‚

**æˆ»ã‚Šå€¤:**
- `dict`: Notion APIã®dividerãƒ–ãƒ­ãƒƒã‚¯

**ä½¿ç”¨ä¾‹:**
```python
from src.utils.block_builder import divider

block = divider()
# -> {"type": "divider", "divider": {}}
```

---

### ãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆé–¢æ•°

#### `build_app_table(app_usage: list[AppUsage]) -> dict[str, Any]`

ã‚¢ãƒ—ãƒªä½¿ç”¨çŠ¶æ³ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”Ÿæˆã€‚

**å¼•æ•°:**
- `app_usage` (list[AppUsage]): AppUsageã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆ

**æˆ»ã‚Šå€¤:**
- `dict`: Notion APIå½¢å¼ã®tableãƒ–ãƒ­ãƒƒã‚¯ï¼ˆ4åˆ—: ã‚¢ãƒ—ãƒª | æ™‚é–“ | é »åº¦ | ä¸»ãªç”¨é€”ï¼‰

**ä½¿ç”¨ä¾‹:**
```python
from src.domain.report import AppUsage
from src.utils.block_builder import build_app_table

apps = [
    AppUsage(name="VS Code", duration_min=120, rank="high", purpose="é–‹ç™º"),
    AppUsage(name="Chrome", duration_min=60, rank="medium", purpose="èª¿æŸ»")
]

table = build_app_table(apps)
# -> {"type": "table", "table": {"table_width": 4, "children": [...]}}
```

---

#### `rank_to_emoji(rank: str) -> str`

ä½¿ç”¨é »åº¦ãƒ©ãƒ³ã‚¯ã‚’çµµæ–‡å­—è¡¨è¨˜ã«å¤‰æ›ã€‚

**å¼•æ•°:**
- `rank` (str): ãƒ©ãƒ³ã‚¯å€¤ ("high", "medium", "low")

**æˆ»ã‚Šå€¤:**
- `str`: çµµæ–‡å­—ä»˜ããƒ©ãƒ³ã‚¯è¡¨è¨˜

**ãƒ©ãƒ³ã‚¯ãƒãƒƒãƒ”ãƒ³ã‚°:**

| ãƒ©ãƒ³ã‚¯ | å‡ºåŠ› |
|--------|------|
| high | ğŸ”´ å¤š |
| medium | ğŸŸ¡ ä¸­ |
| low | ğŸŸ¢ å°‘ |
| ãã®ä»– | - |

**ä½¿ç”¨ä¾‹:**
```python
from src.utils.block_builder import rank_to_emoji

emoji = rank_to_emoji("high")  # -> "ğŸ”´ å¤š"
```

---

### ãƒ¬ãƒãƒ¼ãƒˆå…¨ä½“ã®ãƒ–ãƒ­ãƒƒã‚¯ç”Ÿæˆ

#### `build_report_blocks(report: Report | dict[str, Any]) -> list[dict[str, Any]]`

æ—¥å ±ãƒ¬ãƒãƒ¼ãƒˆã‹ã‚‰å®Œå…¨ãªæœ¬æ–‡ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç”Ÿæˆï¼ˆçµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰ã€‚

**å¼•æ•°:**
- `report` (Report | dict): Reportã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¾ãŸã¯è¾æ›¸å½¢å¼ã®ãƒ¬ãƒãƒ¼ãƒˆ

**æˆ»ã‚Šå€¤:**
- `list[dict]`: Notion APIãƒ–ãƒ­ãƒƒã‚¯ã®ãƒªã‚¹ãƒˆ

**ç”Ÿæˆã•ã‚Œã‚‹ãƒ–ãƒ­ãƒƒã‚¯æ§‹é€ :**
```
ğŸ“Š åŸºæœ¬æƒ…å ±
  - ä½œæ¥­ã‚µãƒãƒªãƒ¼
  - ç”Ÿæˆæ—¥æ™‚
  - LLMã‚¨ãƒ©ãƒ¼ï¼ˆå¤±æ•—æ™‚ï¼‰

ğŸ¯ æœ¬æ—¥ã®ãƒ¡ã‚¤ãƒ³ä½œæ¥­
  - ç•ªå·ä»˜ããƒªã‚¹ãƒˆï¼ˆã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒˆãƒ«ï¼‰
  - æ®µè½ï¼ˆã‚¿ã‚¹ã‚¯è©³ç´°ï¼‰

ğŸ’¡ çŸ¥è¦‹ãƒ»ãƒ¡ãƒ¢
  - ç®‡æ¡æ›¸ããƒªã‚¹ãƒˆï¼ˆ[ã‚«ãƒ†ã‚´ãƒª] å†…å®¹ï¼‰

ğŸ“± ã‚¢ãƒ—ãƒªä½¿ç”¨çŠ¶æ³
  - ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚¢ãƒ—ãƒª | æ™‚é–“ | é »åº¦ | ä¸»ãªç”¨é€”ï¼‰

ğŸ“ ä½œæ¥­ãƒ•ã‚¡ã‚¤ãƒ«
  - ç®‡æ¡æ›¸ããƒªã‚¹ãƒˆï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åï¼‰

---
ğŸ¤– Generated by Daily Report Bot
```

**ä½¿ç”¨ä¾‹ï¼ˆReportã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼‰:**
```python
from src.domain.report import Report, ReportMeta, MainTask, Insight, AppUsage
from src.utils.block_builder import build_report_blocks

report = Report(
    meta=ReportMeta(date="2025-01-15"),
    main_tasks=[
        MainTask(title="ãƒ‡ãƒ¼ã‚¿é›†è¨ˆå‡¦ç†ã‚’å®Ÿè£…", description="JSONLèª­ã¿è¾¼ã¿ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³åŒ–ã‚’å®Œæˆ")
    ],
    insights=[
        Insight(category="æŠ€è¡“", content="Pydanticã®å‹æ¤œè¨¼ãŒä¾¿åˆ©")
    ],
    work_summary="æ—¥å ±ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ã®åŸºç›¤æ©Ÿèƒ½ã‚’å®Ÿè£…å®Œäº†",
    app_usage=[
        AppUsage(name="VS Code", duration_min=180, rank="high", purpose="é–‹ç™º")
    ],
    files=["src/utils/block_builder.py"]
)

blocks = build_report_blocks(report)
# -> [{"type": "heading_2", ...}, {"type": "paragraph", ...}, ...]
```

**ä½¿ç”¨ä¾‹ï¼ˆè¾æ›¸å½¢å¼ï¼‰:**
```python
report_dict = {
    "meta": {"date": "2025-01-15", "generated_at": "2025-01-15T18:00:00"},
    "main_tasks": [{"title": "ã‚¿ã‚¹ã‚¯1", "description": "è©³ç´°1"}],
    "insights": [{"category": "æŠ€è¡“", "content": "çŸ¥è¦‹1"}],
    "work_summary": "ä½œæ¥­å®Œäº†",
    "app_usage": [
        {"name": "App1", "duration_min": 100, "rank": "high", "purpose": "ç›®çš„1"}
    ],
    "files": ["file1.py"]
}

blocks = build_report_blocks(report_dict)
```

---

### ç©ºãƒªã‚¹ãƒˆå¯¾å¿œ

å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ç©ºãƒªã‚¹ãƒˆã®å ´åˆã¯ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º:

| ã‚»ã‚¯ã‚·ãƒ§ãƒ³ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
|-----------|-----------|
| ãƒ¡ã‚¤ãƒ³ä½œæ¥­ | ï¼ˆãƒ¡ã‚¤ãƒ³ä½œæ¥­ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼‰ |
| çŸ¥è¦‹ãƒ»ãƒ¡ãƒ¢ | ï¼ˆçŸ¥è¦‹ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼‰ |
| ã‚¢ãƒ—ãƒªä½¿ç”¨çŠ¶æ³ | ï¼ˆã‚¢ãƒ—ãƒªä½¿ç”¨çŠ¶æ³ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼‰ |
| ä½œæ¥­ãƒ•ã‚¡ã‚¤ãƒ« | ï¼ˆä½œæ¥­ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ¤œå‡ºã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼‰ |

---

### LLMå¤±æ•—æ™‚ã®è¡¨ç¤º

`meta.llm_success == False` ã®å ´åˆã€åŸºæœ¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è­¦å‘Šã‚’è¡¨ç¤º:

```
âš ï¸ LLMè¦ç´„å¤±æ•—: {ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸}
```

---

## time_utils - æ™‚é–“è¨ˆç®—ãƒ˜ãƒ«ãƒ‘ãƒ¼

### å®šæ•°

#### `JST`
```python
JST: timezone  # Asia/Tokyo ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³
```

---

### é–¢æ•°

#### `parse_ts(ts: str) -> datetime`

ISO 8601ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ãƒ‘ãƒ¼ã‚¹ã€‚

**å¼•æ•°:**
- `ts` (str): ISO 8601å½¢å¼ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
  - ä¾‹: `"2024-01-15T09:30:45+09:00"`

**æˆ»ã‚Šå€¤:**
- `datetime`: ãƒ‘ãƒ¼ã‚¹ã•ã‚ŒãŸdatetimeã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

**ä¾‹å¤–:**
- `ValueError`: ãƒ‘ãƒ¼ã‚¹å¤±æ•—æ™‚

**ä½¿ç”¨ä¾‹:**
```python
from src.utils import parse_ts

ts_str = "2024-01-15T09:30:45+09:00"
dt = parse_ts(ts_str)
# -> datetime.datetime(2024, 1, 15, 9, 30, 45, tzinfo=...)
```

---

#### `filter_recent_records(records: list[dict], exclude_sec: int = 120) -> list[dict]`

ç›´è¿‘Nç§’ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’é™¤å¤–ï¼ˆãƒ­ã‚¬ãƒ¼è¨˜éŒ²ä¸­ã®ä¸å®Œå…¨ãƒ‡ãƒ¼ã‚¿ã‚’æ’é™¤ï¼‰ã€‚

**å¼•æ•°:**
- `records` (list[dict]): ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å«ã‚€ãƒ¬ã‚³ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ
- `exclude_sec` (int): é™¤å¤–ã™ã‚‹ç§’æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 120ç§’ï¼‰

**æˆ»ã‚Šå€¤:**
- `list[dict]`: ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¾Œã®ãƒ¬ã‚³ãƒ¼ãƒ‰

**ä½¿ç”¨ä¾‹:**
```python
from src.utils import filter_recent_records

records = [
    {"timestamp": "2024-01-15T09:00:00+09:00", "app": "Code.exe"},
    {"timestamp": "2024-01-15T14:58:00+09:00", "app": "Chrome.exe"},  # ç›´è¿‘ -> é™¤å¤–
]

# ç›´è¿‘2åˆ†ã‚’é™¤å¤–
stable_records = filter_recent_records(records, exclude_sec=120)
```

---

#### `get_time_block(ts: datetime, block_min: int = 30) -> tuple[str, str]`

æ™‚åˆ»ã‹ã‚‰æ™‚é–“ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆé–‹å§‹ãƒ»çµ‚äº†ï¼‰ã‚’å–å¾—ã€‚

**å¼•æ•°:**
- `ts` (datetime): å¯¾è±¡ã®æ™‚åˆ»
- `block_min` (int): ãƒ–ãƒ­ãƒƒã‚¯ã®é•·ã•ï¼ˆåˆ†ï¼‰ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 30

**æˆ»ã‚Šå€¤:**
- `tuple[str, str]`: (é–‹å§‹æ™‚åˆ», çµ‚äº†æ™‚åˆ») ã® "HH:MM" å½¢å¼

**ä½¿ç”¨ä¾‹:**
```python
from datetime import datetime
from src.utils import get_time_block

ts = datetime(2024, 1, 15, 9, 15)
start, end = get_time_block(ts, block_min=30)
# -> ("09:00", "09:30")

ts = datetime(2024, 1, 15, 14, 45)
start, end = get_time_block(ts, block_min=30)
# -> ("14:30", "15:00")
```

---

#### `calculate_duration_min(first_ts: str, last_ts: str, sampling_interval_sec: int = 120) -> int`

ç·è¨˜éŒ²æ™‚é–“ã‚’è¨ˆç®—ï¼ˆåˆ†å˜ä½ï¼‰ã€‚

ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°é–“éš”ã‚’è€ƒæ…®ã—ã¦ã€æœ€å¾Œã®ã‚µãƒ³ãƒ—ãƒ«ã®æ™‚é–“ã‚‚å«ã‚ãŸç·æ™‚é–“ã‚’è¿”ã™ã€‚

**å¼•æ•°:**
- `first_ts` (str): æœ€åˆã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆISO 8601ï¼‰
- `last_ts` (str): æœ€å¾Œã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆISO 8601ï¼‰
- `sampling_interval_sec` (int): ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°é–“éš”ï¼ˆç§’ï¼‰ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 120

**æˆ»ã‚Šå€¤:**
- `int`: ç·è¨˜éŒ²æ™‚é–“ï¼ˆåˆ†ï¼‰ã€æœ€å°å€¤1åˆ†

**ä½¿ç”¨ä¾‹:**
```python
from src.utils import calculate_duration_min

first = "2024-01-15T09:00:00+09:00"
last = "2024-01-15T09:10:00+09:00"

duration = calculate_duration_min(first, last)
# -> 12åˆ† (10åˆ† + 2åˆ†ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°é–“éš”)
```

---

## text_utils - ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†ãƒ˜ãƒ«ãƒ‘ãƒ¼

### å®šæ•°

#### `PROCESS_TO_APP_NAME`
```python
PROCESS_TO_APP_NAME: dict[str, str]
```

ãƒ—ãƒ­ã‚»ã‚¹åã‹ã‚‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤ºåã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°è¾æ›¸ã€‚

**ä¸»è¦ãªãƒãƒƒãƒ”ãƒ³ã‚°:**
- `"Code.exe"` â†’ `"Visual Studio Code"`
- `"chrome.exe"` â†’ `"Google Chrome"`
- `"EXCEL.EXE"` â†’ `"Microsoft Excel"`
- `"Teams.exe"` â†’ `"Microsoft Teams"`
- ãã®ä»–20ä»¥ä¸Šã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

---

### é–¢æ•°

#### `merge_keywords(records: list[dict], field: str = "keywords") -> list[str]`

å¤§æ–‡å­—å°æ–‡å­—ã‚’ç„¡è¦–ã—ã¦é‡è¤‡æ’é™¤ã—ã€å‡ºç¾é »åº¦é †ã«ã‚½ãƒ¼ãƒˆã€‚

**å¼•æ•°:**
- `records` (list[dict]): ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å«ã‚€ãƒ¬ã‚³ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ
- `field` (str): ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: "keywords"ï¼‰

**æˆ»ã‚Šå€¤:**
- `list[str]`: å‡ºç¾é »åº¦é †ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ

**ä½¿ç”¨ä¾‹:**
```python
from src.utils import merge_keywords

records = [
    {"keywords": ["Python", "API"]},
    {"keywords": ["python", "Testing"]},
    {"keywords": ["API", "python", "Docker"]},
]

merged = merge_keywords(records)
# -> ["python", "API", "Testing", "Docker"]
# pythonãŒ3å›ã€APIãŒ2å›ã€æ®‹ã‚ŠãŒ1å›ãšã¤
```

---

#### `calculate_rank(count: int, total_count: int) -> Literal["high", "medium", "low"]`

ä½¿ç”¨é »åº¦ã§ãƒ©ãƒ³ã‚¯ã‚’åˆ¤å®šã€‚

**å¼•æ•°:**
- `count` (int): å€‹åˆ¥ã‚«ã‚¦ãƒ³ãƒˆ
- `total_count` (int): ç·ã‚«ã‚¦ãƒ³ãƒˆ

**æˆ»ã‚Šå€¤:**
- `Literal["high", "medium", "low"]`:
  - `"high"`: 30%ä»¥ä¸Š
  - `"medium"`: 10%ä»¥ä¸Š30%æœªæº€
  - `"low"`: 10%æœªæº€

**ä½¿ç”¨ä¾‹:**
```python
from src.utils import calculate_rank

rank = calculate_rank(35, 100)  # -> "high" (35%)
rank = calculate_rank(20, 100)  # -> "medium" (20%)
rank = calculate_rank(5, 100)   # -> "low" (5%)
```

---

#### `normalize_app_name(process_name: str | None) -> str`

ãƒ—ãƒ­ã‚»ã‚¹åã‹ã‚‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤ºåã«æ­£è¦åŒ–ã€‚

**å¼•æ•°:**
- `process_name` (str | None): ãƒ—ãƒ­ã‚»ã‚¹å

**æˆ»ã‚Šå€¤:**
- `str`: æ­£è¦åŒ–ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å

**ä½¿ç”¨ä¾‹:**
```python
from src.utils import normalize_app_name

app = normalize_app_name("Code.exe")
# -> "Visual Studio Code"

app = normalize_app_name("chrome.exe")
# -> "Google Chrome"

app = normalize_app_name("unknown.exe")
# -> "unknown.exe" (ãƒãƒƒãƒ”ãƒ³ã‚°ãªã—)

app = normalize_app_name(None)
# -> "Unknown"
```

---

## ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–¹æ³•

### ã™ã¹ã¦ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
```python
from src.utils import (
    JST,
    PROCESS_TO_APP_NAME,
    calculate_duration_min,
    calculate_rank,
    filter_recent_records,
    get_time_block,
    merge_keywords,
    normalize_app_name,
    parse_ts,
)
```

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ¥ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
```python
# æ™‚é–“é–¢é€£ã®ã¿
from src.utils.time_utils import parse_ts, get_time_block

# ãƒ†ã‚­ã‚¹ãƒˆé–¢é€£ã®ã¿
from src.utils.text_utils import normalize_app_name, calculate_rank
```

---

## ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
- `/home/okira/job/daily_report_bot/tests/utils/test_block_builder.py`
- `/home/okira/job/daily_report_bot/tests/utils/test_time_utils.py`
- `/home/okira/job/daily_report_bot/tests/utils/test_text_utils.py`

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
# ã™ã¹ã¦ã®utilsãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
pytest tests/utils/

# å€‹åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆ
pytest tests/utils/test_block_builder.py
pytest tests/utils/test_time_utils.py
pytest tests/utils/test_text_utils.py

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ã
pytest tests/utils/ --cov=src/utils --cov-report=html
```

### å‹•ä½œç¢ºèªã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```bash
python3 scripts/validate_utils.py
```

---

## è¨­è¨ˆåŸå‰‡

### time_utils
- **ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¯¾å¿œ**: ã™ã¹ã¦ã®æ™‚åˆ»å‡¦ç†ã§JST (Asia/Tokyo) ã‚’ä½¿ç”¨
- **å®‰å®šæ€§**: ç›´è¿‘ãƒ‡ãƒ¼ã‚¿é™¤å¤–ã«ã‚ˆã‚Šä¸å®Œå…¨ãªãƒ­ã‚°ã‚’æ’é™¤
- **æŸ”è»Ÿæ€§**: ãƒ–ãƒ­ãƒƒã‚¯é•·ã‚„ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°é–“éš”ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½

### text_utils
- **æ­£è¦åŒ–**: å¤§æ–‡å­—å°æ–‡å­—ã®é•ã„ã‚’å¸å
- **é »åº¦é‡è¦–**: å‡ºç¾å›æ•°ã§ã‚½ãƒ¼ãƒˆã—ã€é‡è¦ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å„ªå…ˆ
- **å¯èª­æ€§**: ãƒ—ãƒ­ã‚»ã‚¹åã‚’äººé–“ãŒèª­ã¿ã‚„ã™ã„ã‚¢ãƒ—ãƒªåã«å¤‰æ›

---

## ä¾å­˜é–¢ä¿‚

- **å¤–éƒ¨ä¾å­˜ãªã—**: æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã¿ä½¿ç”¨
- **Python 3.10+**: Type hints (Unionå‹ã® `|` è¨˜æ³•) ã‚’ä½¿ç”¨
