# Phase 1: MVP仕様

## 概要

| 項目 | 内容 |
|------|------|
| 目標 | ログ収集 → 集計 → Notion出力（LLMなし） |
| 期間 | 2週間 |
| 優先度 | 最高 |

## スコープ

### 含まれる機能

- ✅ 常駐ロガー（2分間隔）
- ✅ ウィンドウタイトル取得
- ✅ スクリーンショット→OCR→削除
- ✅ JSONL保存
- ✅ ショートカットキーで日報生成
- ✅ 集計処理（アプリ別時間計算）
- ✅ Notionページ作成/更新
- ✅ Toast通知（成功/失敗）

### 含まれない機能（後続Phase）

- ❌ LLM要約
- ❌ セッション化
- ❌ プロセス名取得
- ❌ 設定UI
- ❌ 週次/月次レポート

## 機能要件

### FR-1: 常駐ロガー

| ID | 要件 |
|----|------|
| FR-1.1 | 2分間隔でアクティブウィンドウ情報を取得する |
| FR-1.2 | 全画面スクリーンショットを取得する |
| FR-1.3 | OCRでテキストを抽出する |
| FR-1.4 | キーワード・URL・ファイルパスを正規表現で抽出する |
| FR-1.5 | 結果をJSONL形式で日付別ファイルに保存する |
| FR-1.6 | スクリーンショットを処理後に削除する |

### FR-2: 日報生成

| ID | 要件 |
|----|------|
| FR-2.1 | ショートカットキー（Ctrl+Alt+D）で日報生成を開始する |
| FR-2.2 | 当日のログファイルを読み込む |
| FR-2.3 | アプリ別使用時間を集計する |
| FR-2.4 | 頻出キーワード・ファイルを集計する |

### FR-3: Notion出力

| ID | 要件 |
|----|------|
| FR-3.1 | 日報データベースに同日ページが存在するか確認する |
| FR-3.2 | 存在しない場合は新規ページを作成する |
| FR-3.3 | 存在する場合は既存ページを更新する |
| FR-3.4 | 本文に基本情報・アプリ使用状況・ファイル一覧を含める |

### FR-4: 通知

| ID | 要件 |
|----|------|
| FR-4.1 | 日報生成成功時にToast通知を表示する |
| FR-4.2 | 成功通知にはNotionページURLを含める |
| FR-4.3 | クリックでNotionページを開く |
| FR-4.4 | 失敗時はエラー内容を通知する |

## 非機能要件

### NFR-1: 性能

| ID | 要件 |
|----|------|
| NFR-1.1 | ロガーのCPU使用率は1%未満 |
| NFR-1.2 | 日報生成は30秒以内に完了 |
| NFR-1.3 | メモリ使用量は100MB未満 |

### NFR-2: 可用性

| ID | 要件 |
|----|------|
| NFR-2.1 | ロガー停止しても既存ログで日報生成可能 |
| NFR-2.2 | OCR失敗時もウィンドウ情報は記録 |
| NFR-2.3 | Notion接続失敗時はローカル保存 |

### NFR-3: 運用

| ID | 要件 |
|----|------|
| NFR-3.1 | ログファイルは30日間保持 |
| NFR-3.2 | 日付跨ぎで自動的にファイル切り替え |

## データ仕様

### raw.jsonl（MVP版）

```json
{
  "ts": "2025-01-15T09:00:00+09:00",
  "window_title": "main.py - Visual Studio Code",
  "keywords": ["Python", "def"],
  "urls": ["docs.python.org"],
  "files": ["main.py"]
}
```

### Notionページ（MVP版）

```
📋 2025-01-15 日報

## 📊 基本情報
記録期間: 09:00 〜 18:00
キャプチャ数: 240回
作業時間: 478分

## 🎯 本日のメイン作業
（自動要約は未実装です）

## 📱 アプリ使用状況
| アプリ | 時間 | 頻度 |
|--------|------|------|
| Visual Studio Code | 240分 | 🔴 多 |
| Chrome | 160分 | 🔴 多 |
| Slack | 80分 | 🟡 中 |

## 📁 作業ファイル
- main.py
- routes.py
- models.py

---
🤖 Generated by Daily Report Bot (MVP)
```

## 受け入れ基準

### AC-1: ロガー

- [ ] タスクスケジューラでログオン時に起動
- [ ] 2分間隔で正常にログ追記
- [ ] 8時間稼働でエラーなし
- [ ] 日付跨ぎでファイル切り替え

### AC-2: 日報生成

- [ ] Ctrl+Alt+Dで日報生成開始
- [ ] Notionにページ作成/更新
- [ ] アプリ使用状況テーブルが正確
- [ ] ファイル一覧が表示

### AC-3: 通知

- [ ] 成功時にToast表示
- [ ] Toast クリックでNotion開く
- [ ] 失敗時にエラーToast表示

## 実装タスク

### Week 1

| タスク | 担当 | 見積 |
|--------|------|------|
| プロジェクト構成作成 | - | 2h |
| 常駐ロガー実装（PowerShell） | - | 8h |
| OCR処理実装 | - | 4h |
| JSONL出力実装 | - | 2h |
| タスクスケジューラ設定 | - | 1h |

### Week 2

| タスク | 担当 | 見積 |
|--------|------|------|
| 集計処理実装（Python） | - | 4h |
| Notion出力実装 | - | 6h |
| Toast通知実装 | - | 2h |
| AutoHotkeyショートカット設定 | - | 1h |
| 統合テスト | - | 4h |
| ドキュメント整備 | - | 2h |

## リスク

| リスク | 影響 | 対策 |
|--------|------|------|
| WinRT OCRが環境で動かない | 高 | PsOcrモジュールで代替 |
| Notion API変更 | 中 | 公式SDKを使用 |
| 高DPI環境でスクショ不正 | 低 | DPI考慮したキャプチャ実装 |
