# Phase 5: プロダクト化仕様

## 概要

| 項目 | 内容 |
|------|------|
| 目標 | 設定UI・監査・週次レポート・複数PC対応 |
| 前提 | Phase 4完了 |
| 期間 | 2週間 |
| 優先度 | 低 |

## スコープ

### 含まれる機能

- ✅ 設定UI（GUI）
- ✅ 監査ログ
- ✅ 週次/月次レポート自動生成
- ✅ 複数PC対応
- ✅ マスク辞書（個人情報フィルタ）
- ✅ インストーラー

### Phase 4からの変更点

| 項目 | Phase 4 | Phase 5 |
|------|---------|---------|
| 設定 | JSONファイル | GUI |
| 監査 | なし | 生成履歴記録 |
| レポート | 日次のみ | 週次/月次 |
| PC | 単一 | 複数対応 |

## 機能要件

### FR-19: 設定UI

| ID | 要件 |
|----|------|
| FR-19.1 | システムトレイアイコンから設定画面を開く |
| FR-19.2 | サンプリング間隔を設定可能 |
| FR-19.3 | 除外アプリを設定可能 |
| FR-19.4 | マスク辞書を設定可能 |
| FR-19.5 | Notion接続テスト機能 |
| FR-19.6 | LLM APIキー設定 |

### FR-20: 監査ログ

| ID | 要件 |
|----|------|
| FR-20.1 | 日報生成日時を記録 |
| FR-20.2 | 入力ログファイル名を記録 |
| FR-20.3 | NotionページIDを記録 |
| FR-20.4 | LLM使用/不使用を記録 |
| FR-20.5 | 成功/失敗を記録 |

### FR-21: 週次/月次レポート

| ID | 要件 |
|----|------|
| FR-21.1 | 週末（日曜）に週次レポート自動生成 |
| FR-21.2 | 月末に月次レポート自動生成 |
| FR-21.3 | アプリ使用傾向の可視化 |
| FR-21.4 | 生産性指標の集計 |

### FR-22: 複数PC対応

| ID | 要件 |
|----|------|
| FR-22.1 | PC名/ユーザー名をログに含める |
| FR-22.2 | Notionページにソースを表示 |
| FR-22.3 | PC別の集計オプション |

### FR-23: マスク辞書

| ID | 要件 |
|----|------|
| FR-23.1 | メールアドレスを自動マスク |
| FR-23.2 | 電話番号を自動マスク |
| FR-23.3 | カスタムパターンを設定可能 |
| FR-23.4 | LLM送信前にマスク適用 |

### FR-24: インストーラー

| ID | 要件 |
|----|------|
| FR-24.1 | ワンクリックインストール |
| FR-24.2 | 依存関係自動インストール |
| FR-24.3 | タスクスケジューラ自動設定 |
| FR-24.4 | アンインストーラー |

## 設定UI設計

### メイン画面

```
┌─────────────────────────────────────────────┐
│ Daily Report Bot 設定                        │
├─────────────────────────────────────────────┤
│ [一般] [ロガー] [Notion] [LLM] [プライバシー]   │
├─────────────────────────────────────────────┤
│                                             │
│ サンプリング間隔: [120] 秒                    │
│                                             │
│ 除外アプリ:                                  │
│ ┌─────────────────────────────────┐         │
│ │ LockApp.exe                     │ [削除]  │
│ │ ScreenClipping.exe              │ [削除]  │
│ └─────────────────────────────────┘         │
│ [追加]                                       │
│                                             │
│ [✓] スタートアップに登録                      │
│ [✓] 成功時にToast通知                        │
│                                             │
├─────────────────────────────────────────────┤
│                        [キャンセル] [保存]    │
└─────────────────────────────────────────────┘
```

### システムトレイメニュー

```
┌──────────────────────┐
│ 📊 本日の統計        │
│ 📝 日報を生成        │
│ ───────────────────  │
│ ⚙️ 設定             │
│ 📁 ログフォルダを開く │
│ ───────────────────  │
│ ⏸️ 一時停止 / ▶️ 再開 │
│ 🚪 終了             │
└──────────────────────┘
```

## 監査ログ仕様

### audit.jsonl

```json
{
  "ts": "2025-01-15T18:00:00+09:00",
  "action": "generate_report",
  "date": "2025-01-15",
  "input_file": "2025-01-15.jsonl",
  "capture_count": 240,
  "llm_used": true,
  "llm_model": "gpt-4o-mini",
  "notion_page_id": "xxxxx-xxxx-xxxx",
  "notion_url": "https://notion.so/xxxxx",
  "success": true,
  "duration_ms": 5432,
  "pc_name": "DESKTOP-ABC123",
  "user_name": "okira"
}
```

## 週次レポート仕様

### Notionページ構成

```
📊 2025年第3週 週次レポート

## 概要
- 記録日数: 5日
- 総作業時間: 2,390分（約40時間）
- 総キャプチャ数: 1,200回

## アプリ使用傾向
| アプリ | 時間 | 先週比 |
|--------|------|--------|
| VSCode | 1,200分 | +15% |
| Chrome | 800分 | -5% |

## 生産性指標
- 集中時間（連続30分以上）: 28時間
- アプリ切替回数/日: 平均45回

## 週間ハイライト
- 最も長く使ったファイル: main.py (180分)
- 最も参照したドキュメント: docs.python.org
```

## 受け入れ基準

### AC-13: 設定UI

- [ ] トレイアイコンから設定画面を開ける
- [ ] 設定変更が即座に反映
- [ ] Notion接続テストが動作

### AC-14: 監査ログ

- [ ] 全日報生成が記録される
- [ ] 失敗時も記録される
- [ ] 30日以上のログが保持

### AC-15: 週次レポート

- [ ] 日曜に自動生成
- [ ] アプリ使用傾向が可視化
- [ ] Notionに出力

### AC-16: インストーラー

- [ ] ダブルクリックでインストール開始
- [ ] 依存関係エラーなし
- [ ] アンインストールで完全削除

## 実装タスク

### Week 1

| タスク | 見積 |
|--------|------|
| 設定UI実装（WPF/WinForms） | 12h |
| システムトレイ実装 | 4h |
| 設定ファイル管理 | 4h |
| マスク辞書実装 | 4h |

### Week 2

| タスク | 見積 |
|--------|------|
| 監査ログ実装 | 4h |
| 週次レポート生成 | 8h |
| 月次レポート生成 | 4h |
| 複数PC対応 | 4h |
| インストーラー作成 | 6h |
| テスト・バグ修正 | 8h |

## 技術スタック

| コンポーネント | 技術 |
|--------------|------|
| 設定UI | WPF (.NET 6) or Electron |
| トレイアイコン | System.Windows.Forms.NotifyIcon |
| インストーラー | Inno Setup or WiX |
